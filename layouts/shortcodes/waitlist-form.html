<div class="waitlist-container">
  <form id="waitlist-form" class="waitlist-form">
    <div class="form-group">
      <label for="waitlist-email">Email Address *</label>
      <input type="email" id="waitlist-email" name="email" placeholder="hacker@example.com" required>
    </div>
    <div class="form-group">
      <label for="waitlist-name">Full Name</label>
      <input type="text" id="waitlist-name" name="name" placeholder="Your name (optional)">
    </div>
    <button type="submit" class="btn primary waitlist-btn">
      <span class="btn-text">We're Sold out - Join the Waitlist</span>
      <span class="btn-loading" style="display: none;">Submitting...</span>
    </button>
  </form>
  <div id="waitlist-message" class="waitlist-message"></div>
</div>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
  
  const supabase = createClient(
    'https://meuturtnbztphdlkfxtv.supabase.co',
    'sb_publishable_hhoNGltFJLtZ_65DBsd7Fg_cO7P4cXa'
  )

  const form = document.getElementById('waitlist-form')
  const messageEl = document.getElementById('waitlist-message')
  const submitBtn = form.querySelector('button[type="submit"]')
  const btnText = submitBtn.querySelector('.btn-text')
  const btnLoading = submitBtn.querySelector('.btn-loading')

  form.addEventListener('submit', async (e) => {
    e.preventDefault()
    
    // Show loading state
    btnText.style.display = 'none'
    btnLoading.style.display = 'inline'
    submitBtn.disabled = true
    messageEl.textContent = ''
    messageEl.className = 'waitlist-message'

    const email = document.getElementById('waitlist-email').value.trim()
    const name = document.getElementById('waitlist-name').value.trim() || null

    try {
      const { error } = await supabase
        .from('waitlist')
        .insert({ email, name })

      if (error) {
        if (error.code === '23505') {
          messageEl.textContent = 'üéâ This email is already on the waitlist!'
          messageEl.className = 'waitlist-message info'
        } else {
          console.error('Supabase error:', error)
          messageEl.textContent = '‚ùå Something went wrong. Please try again.'
          messageEl.className = 'waitlist-message error'
        }
      } else {
        messageEl.textContent = '‚úÖ You\'re on the list! We\'ll be in touch soon.'
        messageEl.className = 'waitlist-message success'
        form.reset()
      }
    } catch (err) {
      console.error('Network error:', err)
      messageEl.textContent = '‚ùå Network error. Please check your connection.'
      messageEl.className = 'waitlist-message error'
    }

    // Reset button state
    btnText.style.display = 'inline'
    btnLoading.style.display = 'none'
    submitBtn.disabled = false
  })
</script>

<style>
.waitlist-container {
  max-width: 500px;
  margin: 2rem auto;
  padding: 2rem;
  background: #ffffff;
  border-radius: 12px;
  border: 1px solid rgba(31, 163, 255, 0.3);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.waitlist-form .form-group {
  margin-bottom: 1.5rem;
}

.waitlist-form label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: #333;
  font-size: 0.95rem;
}

.waitlist-form input {
  width: 100%;
  padding: 0.875rem 1rem;
  font-size: 1rem;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  background: #f9f9f9;
  color: #333;
  transition: border-color 0.2s, box-shadow 0.2s;
  box-sizing: border-box;
}

.waitlist-form input::placeholder {
  color: #999;
}

.waitlist-form input:focus {
  outline: none;
  border-color: #1FA3FF;
  box-shadow: 0 0 0 3px rgba(31, 163, 255, 0.2);
}

.waitlist-btn {
  width: 100%;
  padding: 1rem 2rem;
  font-size: 1.1rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.waitlist-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(31, 163, 255, 0.4);
}

.waitlist-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.waitlist-message {
  margin-top: 1.5rem;
  padding: 1rem;
  border-radius: 8px;
  text-align: center;
  font-weight: 500;
  display: none;
}

.waitlist-message:not(:empty) {
  display: block;
}

.waitlist-message.success {
  background: rgba(16, 185, 129, 0.2);
  border: 1px solid rgba(16, 185, 129, 0.5);
  color: #10b981;
}

.waitlist-message.error {
  background: rgba(239, 68, 68, 0.2);
  border: 1px solid rgba(239, 68, 68, 0.5);
  color: #ef4444;
}

.waitlist-message.info {
  background: rgba(31, 163, 255, 0.2);
  border: 1px solid rgba(31, 163, 255, 0.5);
  color: #1FA3FF;
}
</style>

